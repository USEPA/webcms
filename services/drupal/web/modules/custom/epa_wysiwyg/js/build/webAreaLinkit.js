!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.CKEditor5=t():(e.CKEditor5=e.CKEditor5||{},e.CKEditor5.webAreaLinkit=t())}(self,(function(){return function(){var e={"ckeditor5/src/core.js":function(e,t,i){e.exports=i("dll-reference CKEditor5.dll")("./src/core.js")},"ckeditor5/src/ui.js":function(e,t,i){e.exports=i("dll-reference CKEditor5.dll")("./src/ui.js")},"ckeditor5/src/utils.js":function(e,t,i){e.exports=i("dll-reference CKEditor5.dll")("./src/utils.js")},"dll-reference CKEditor5.dll":function(e){"use strict";e.exports=CKEditor5.dll}},t={};function i(n){var l=t[n];if(void 0!==l)return l.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,i),o.exports}i.d=function(e,t){for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};var n={};return function(){"use strict";i.d(n,{default:function(){return d}});var e=i("ckeditor5/src/ui.js"),t=i("ckeditor5/src/core.js"),l=i("ckeditor5/src/utils.js");const o=jQuery;function s(e,t){var i=o("<li>").addClass("linkit-result-line"),n=o("<div>").addClass("linkit-result-line-wrapper");return n.append(o("<span>").html(t.label).addClass("linkit-result-line--title")),t.hasOwnProperty("description")&&n.append(o("<span>").html(t.description).addClass("linkit-result-line--description")),i.append(n).appendTo(e)}function r(e,t){var i=this.element.autocomplete("instance"),n={};t.forEach((function(e){const t=e.hasOwnProperty("group")?e.group:"";n.hasOwnProperty(t)||(n[t]=[]),n[t].push(e)})),o.each(n,(function(t,n){t.length&&e.append('<li class="linkit-result-line--group ui-menu-divider">'+t+"</li>"),o.each(n,(function(t,n){i._renderItemData(e,n)}))}))}class a extends t.Plugin{static get pluginName(){return"WebAreaLinkit"}init(){this.locale=this.editor.locale,this.options={...this.editor.config.get("linkit"),autocompleteUrl:"/linkit/autocomplete/web_area_content"},this.editor.plugins.get("LinkUI")._createViews&&this.editor.plugins.get("LinkUI")._createViews(),this._extendLinkUITemplate(),this._handleExtraFormFieldSubmit(),this._handleDataLoadingIntoExtraFormField()}_extendLinkUITemplate(){const{editor:t}=this;let i=!1;t.plugins.get("ContextualBalloon").on("set:visibleView",((n,l,a,d)=>{const u=t.plugins.get("LinkUI").formView,c=t.commands.get("link");if(a===d||a!==u)return;if(void 0===u.linkitProfileSelect){const t=(0,e.createDropdown)(this.locale,e.DropdownButtonView),i=this._buildLinkitProfileList();(0,e.addListToDropdown)(t,i),t.buttonView.set(i.get(1).model),t.extendTemplate({attributes:{class:["ck-epa-web-area-linkit-dropdown"]}}),u.children.add(t,0),u._focusables.add(t,0),u.focusTracker.add(t.element),u.linkitProfileSelect=t}if(void 0===u.myWebAreasLinkField){const e=this._createUrlInput();let t;u.children.add(e,1),u._focusables.add(e,1),u.focusTracker.add(e.element),u.myWebAreasLinkField=e,u.myWebAreasLinkField.fieldView.element.value=c.myWebAreasLinkField||"",function(e,t){const{autocompleteUrl:i,selectHandler:n,closeHandler:l,openHandler:a}=t,d={cache:{},ajax:{dataType:"json",jsonp:!1}},u={appendTo:e.closest(".ck-labeled-field-view"),source:function(e,t){const{cache:n}=d;var l=e.term;n.hasOwnProperty(l)?t(n[l]):o.ajax(i,{success:function(e){n[l]=e.suggestions,t(e.suggestions)},data:{q:l},...d.ajax})},select:n,focus:()=>!1,search:()=>!u.isComposing,close:l,open:a,minLength:1,isComposing:!1},c=o(e).autocomplete(u),p=c.data("ui-autocomplete");p.widget().menu("option","items","> :not(.linkit-result-line--group)"),p._renderMenu=r,p._renderItem=s,c.autocomplete("widget").addClass("linkit-ui-autocomplete ck-reset_all-excluded"),c.on("click",(function(){c.autocomplete("search",c.val())})),c.on("compositionstart.autocomplete",(function(){u.isComposing=!0})),c.on("compositionend.autocomplete",(function(){u.isComposing=!1}))}(e.fieldView.element,{...this.options,selectHandler:(e,{item:i})=>{if(!i.path)throw"Missing path param."+JSON.stringify(i);if(i.entity_type_id||i.entity_uuid||i.substitution_id){if(!i.entity_type_id||!i.entity_uuid||!i.substitution_id)throw"Missing path param."+JSON.stringify(i);this.set("entityType",i.entity_type_id),this.set("entityUuid",i.entity_uuid),this.set("entitySubstitution",i.substitution_id)}else this.set("entityType",null),this.set("entityUuid",null),this.set("entitySubstitution",null);return e.target.value=i.path,u.urlInputView.fieldView.element.value=i.path,t=!0,!1},openHandler:e=>{t=!1},closeHandler:e=>{t||(this.set("entityType",null),this.set("entityUuid",null),this.set("entitySubstitution",null)),t=!1}})}u.urlInputView.element.style.display="block",u.myWebAreasLinkField.element.style.display="none",i=!0;let p=u.saveButtonView,h=u.cancelButtonView;u.children.remove(p),u.children.remove(h),u.children.add(p),u.children.add(h),this.listenTo(u.linkitProfileSelect,"execute",(e=>{!0===e.source.linkitAll?(u.urlInputView.element.style.display="block",u.myWebAreasLinkField.element.style.display="none"):(u.urlInputView.element.style.display="none",u.myWebAreasLinkField.element.style.display="block"),u.linkitProfileSelect.buttonView.label=e.source.label}))}))}_buildLinkitProfileList(){const t=new l.Collection;return t.add({type:"button",model:new e.Model({withText:!0,label:this.locale.t("Your internal links"),tooltip:this.locale.t("Search within your web areas only."),linkitAll:!1})}),t.add({type:"button",model:new e.Model({withText:!0,label:this.locale.t("No filter: all WebCMS content"),tooltip:this.locale.t("Search within your web areas and www.epa.gov."),linkitAll:!0})}),t}_createUrlInput(){const t=this.locale.t,i=new e.LabeledFieldView(this.locale,e.createLabeledInputText);return i.label=t("Link URL"),i}_handleExtraFormFieldSubmit(){const e=this.editor,t=e.plugins.get("LinkUI").formView,i=e.commands.get("link");this.listenTo(t,"submit",(()=>{const e={"data-entity-type":this.entityType,"data-entity-uuid":this.entityUuid,"data-entity-substitution":this.entitySubstitution};i.once("execute",((t,i)=>{if(i.length<3)i.push(e);else{if(3!==i.length)throw Error("The link command has more than 3 arguments.");Object.assign(i[2],e)}}),{priority:"highest"})}),{priority:"high"})}_handleDataLoadingIntoExtraFormField(){const e=this.editor.commands.get("link");this.bind("entityType").to(e,"data-entity-type"),this.bind("entityUuid").to(e,"data-entity-uuid"),this.bind("entitySubstitution").to(e,"data-entity-substitution")}}var d={WebAreaLinkit:a}}(),n=n.default}()}));